<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PGI-IA - Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com">
    
    // Upload PDF functionality
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const selectFilesBtn = document.getElementById('selectFiles');
    const uploadBtn = document.getElementById('uploadBtn');
    
    // Click to select files
    selectFilesBtn?.addEventListener('click', () => fileInput.click());
    uploadBtn?.addEventListener('click', () => fileInput.click());
    
    // File input change
    fileInput?.addEventListener('change', (e) => {
        handleFiles(e.target.files);
    });
    
    // Drag and drop
    uploadZone?.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('border-blue-500', 'bg-blue-50');
    });
    
    uploadZone?.addEventListener('dragleave', () => {
        uploadZone.classList.remove('border-blue-500', 'bg-blue-50');
    });
    
    uploadZone?.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('border-blue-500', 'bg-blue-50');
        handleFiles(e.dataTransfer.files);
    });
    
    // Handle files
    async function handleFiles(files) {
        for (const file of files) {
            if (file.type === 'application/pdf') {
                await uploadFile(file);
            } else {
                alert(`${file.name} n'est pas un fichier PDF`);
            }
        }
    }
    
    // Upload file
    async function uploadFile(file) {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('project_id', 'kahnawake'); // Default project
        
        // Show progress
        const progressDiv = document.createElement('div');
        progressDiv.className = 'p-4 bg-blue-50 border-l-4 border-blue-500 mb-4';
        progressDiv.innerHTML = `
            <div class="flex items-center">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-3"></div>
                <span>Upload de ${file.name}...</span>
            </div>
        `;
        document.getElementById('documentsList').prepend(progressDiv);
        
        try {
            const response = await fetch('http://localhost:5000/upload', {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                const result = await response.json();
                progressDiv.innerHTML = `
                    <div class="flex items-center text-green-600">
                        <i data-lucide="check-circle" class="w-6 h-6 mr-3"></i>
                        <span>${file.name} uploadé avec succès!</span>
                    </div>
                `;
                
                // Refresh documents list
                setTimeout(() => {
                    loadDocuments();
                }, 2000);
            } else {
                throw new Error('Upload failed');
            }
        } catch (error) {
            progressDiv.innerHTML = `
                <div class="flex items-center text-red-600">
                    <i data-lucide="x-circle" class="w-6 h-6 mr-3"></i>
                    <span>Erreur lors de l'upload de ${file.name}</span>
                </div>
            `;
        }
        
        // Re-initialize lucide icons
        lucide.createIcons();
    }
    
    // Load documents list
    async function loadDocuments() {
        try {
            const response = await fetch('http://localhost:5000/api/documents');
            if (response.ok) {
                const documents = await response.json();
                const listDiv = document.getElementById('documentsList');
                
                if (!listDiv) {
                    console.error('Element documentsList not found');
                    return;
                }
                
                if (documents.length === 0) {
                    listDiv.innerHTML = `
                        <div class="p-8 text-center text-gray-500">
                            <i data-lucide="inbox" class="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
                            <p class="text-lg">Aucun document trouvé</p>
                            <p class="text-sm mt-2">Uploadez votre premier plan PDF pour commencer</p>
                        </div>
                    `;
                } else {
                    listDiv.innerHTML = documents.map(doc => `
                        <div class="p-4 hover:bg-gray-50 transition-colors cursor-pointer">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <i data-lucide="file-text" class="w-8 h-8 text-gray-400 mr-3"></i>
                                    <div>
                                        <h4 class="font-medium">${doc.filename}</h4>
                                        <p class="text-sm text-gray-600">${doc.project} - ${new Date(doc.date).toLocaleDateString('fr-CA')}</p>
                                        ${doc.status === 'completed' ? 
                                            '<span class="text-xs text-green-600">✓ Analyse complétée</span>' : 
                                            '<span class="text-xs text-yellow-600">⏳ Analyse en cours...</span>'
                                        }
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="text-blue-600 hover:text-blue-800 p-1" title="Voir les détails">
                                        <i data-lucide="eye" class="w-5 h-5"></i>
                                    </button>
                                    <button class="text-green-600 hover:text-green-800 p-1" title="Télécharger">
                                        <i data-lucide="download" class="w-5 h-5"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
                
                // Re-initialiser les icônes Lucide
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            } else {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
        } catch (error) {
            console.error('Error loading documents:', error);
            const listDiv = document.getElementById('documentsList');
            if (listDiv) {
                listDiv.innerHTML = `
                    <div class="p-8 text-center text-red-500">
                        <i data-lucide="alert-circle" class="w-16 h-16 mx-auto mb-4"></i>
                        <p class="text-lg">Erreur de chargement</p>
                        <p class="text-sm mt-2">Impossible de charger les documents. Vérifiez que le serveur est démarré.</p>
                        <button onclick="loadDocuments()" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                            Réessayer
                        </button>
                    </div>
                `;
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }
        }
    }
        } catch (error) {
            console.error('Error loading documents:', error);
        }
    }
</script>
    <script src="https://unpkg.com/lucide@latest">
    
    // Upload PDF functionality
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const selectFilesBtn = document.getElementById('selectFiles');
    const uploadBtn = document.getElementById('uploadBtn');
    
    // Click to select files
    selectFilesBtn?.addEventListener('click', () => fileInput.click());
    uploadBtn?.addEventListener('click', () => fileInput.click());
    
    // File input change
    fileInput?.addEventListener('change', (e) => {
        handleFiles(e.target.files);
    });
    
    // Drag and drop
    uploadZone?.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('border-blue-500', 'bg-blue-50');
    });
    
    uploadZone?.addEventListener('dragleave', () => {
        uploadZone.classList.remove('border-blue-500', 'bg-blue-50');
    });
    
    uploadZone?.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('border-blue-500', 'bg-blue-50');
        handleFiles(e.dataTransfer.files);
    });
    
    // Handle files
    async function handleFiles(files) {
        for (const file of files) {
            if (file.type === 'application/pdf') {
                await uploadFile(file);
            } else {
                alert(`${file.name} n'est pas un fichier PDF`);
            }
        }
    }
    
    // Upload file
    async function uploadFile(file) {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('project_id', 'kahnawake'); // Default project
        
        // Show progress
        const progressDiv = document.createElement('div');
        progressDiv.className = 'p-4 bg-blue-50 border-l-4 border-blue-500 mb-4';
        progressDiv.innerHTML = `
            <div class="flex items-center">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-3"></div>
                <span>Upload de ${file.name}...</span>
            </div>
        `;
        document.getElementById('documentsList').prepend(progressDiv);
        
        try {
            const response = await fetch('http://localhost:5000/upload', {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                const result = await response.json();
                progressDiv.innerHTML = `
                    <div class="flex items-center text-green-600">
                        <i data-lucide="check-circle" class="w-6 h-6 mr-3"></i>
                        <span>${file.name} uploadé avec succès!</span>
                    </div>
                `;
                
                // Refresh documents list
                setTimeout(() => {
                    loadDocuments();
                }, 2000);
            } else {
                throw new Error('Upload failed');
            }
        } catch (error) {
            progressDiv.innerHTML = `
                <div class="flex items-center text-red-600">
                    <i data-lucide="x-circle" class="w-6 h-6 mr-3"></i>
                    <span>Erreur lors de l'upload de ${file.name}</span>
                </div>
            `;
        }
        
        // Re-initialize lucide icons
        lucide.createIcons();
    }
    
    // Load documents list
    
        } catch (error) {
            console.error('Error loading documents:', error);
        }
    }
</script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js">
    
    // Upload PDF functionality
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const selectFilesBtn = document.getElementById('selectFiles');
    const uploadBtn = document.getElementById('uploadBtn');
    
    // Click to select files
    selectFilesBtn?.addEventListener('click', () => fileInput.click());
    uploadBtn?.addEventListener('click', () => fileInput.click());
    
    // File input change
    fileInput?.addEventListener('change', (e) => {
        handleFiles(e.target.files);
    });
    
    // Drag and drop
    uploadZone?.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('border-blue-500', 'bg-blue-50');
    });
    
    uploadZone?.addEventListener('dragleave', () => {
        uploadZone.classList.remove('border-blue-500', 'bg-blue-50');
    });
    
    uploadZone?.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('border-blue-500', 'bg-blue-50');
        handleFiles(e.dataTransfer.files);
    });
    
    // Handle files
    async function handleFiles(files) {
        for (const file of files) {
            if (file.type === 'application/pdf') {
                await uploadFile(file);
            } else {
                alert(`${file.name} n'est pas un fichier PDF`);
            }
        }
    }
    
    // Upload file
    async function uploadFile(file) {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('project_id', 'kahnawake'); // Default project
        
        // Show progress
        const progressDiv = document.createElement('div');
        progressDiv.className = 'p-4 bg-blue-50 border-l-4 border-blue-500 mb-4';
        progressDiv.innerHTML = `
            <div class="flex items-center">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-3"></div>
                <span>Upload de ${file.name}...</span>
            </div>
        `;
        document.getElementById('documentsList').prepend(progressDiv);
        
        try {
            const response = await fetch('http://localhost:5000/upload', {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                const result = await response.json();
                progressDiv.innerHTML = `
                    <div class="flex items-center text-green-600">
                        <i data-lucide="check-circle" class="w-6 h-6 mr-3"></i>
                        <span>${file.name} uploadé avec succès!</span>
                    </div>
                `;
                
                // Refresh documents list
                setTimeout(() => {
                    loadDocuments();
                }, 2000);
            } else {
                throw new Error('Upload failed');
            }
        } catch (error) {
            progressDiv.innerHTML = `
                <div class="flex items-center text-red-600">
                    <i data-lucide="x-circle" class="w-6 h-6 mr-3"></i>
                    <span>Erreur lors de l'upload de ${file.name}</span>
                </div>
            `;
        }
        
        // Re-initialize lucide icons
        lucide.createIcons();
    }
    
    // Load documents list
    
        } catch (error) {
            console.error('Error loading documents:', error);
        }
    }
</script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .sidebar-transition { transition: width 0.3s ease; }
        .badge { 
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            font-size: 12px;
            font-weight: 600;
            color: white;
            background-color: #EF4444;
            border-radius: 10px;
            margin-left: auto;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .sidebar-item {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            color: #9CA3AF;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            background: none;
            text-align: left;
        }
        .sidebar-item:hover {
            background-color: rgba(55, 65, 81, 0.5);
            color: white;
        }
        .sidebar-item.active {
            background-color: #3B82F6;
            color: white;
        }
        .sidebar-item svg {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            flex-shrink: 0;
        }
        .sidebar-collapsed .sidebar-item svg {
            margin-right: 0;
        }
        .sidebar-collapsed .sidebar-item span {
            display: none;
        }
        .sidebar-collapsed .badge {
            position: absolute;
            top: 0;
            right: 0;
            transform: translate(50%, -50%);
        }
        .email-item {
            transition: all 0.2s;
        }
        .email-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .email-priority-high {
            border-left: 4px solid #EF4444;
        }
        .email-priority-normal {
            border-left: 4px solid #3B82F6;
        }
        .email-priority-low {
            border-left: 4px solid #6B7280;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div id="sidebar" class="bg-gray-900 text-white sidebar-transition" style="width: 256px;">
            <div class="p-4 h-full flex flex-col">
                <div class="flex items-center justify-between mb-8">
                    <h1 id="logo" class="text-2xl font-bold">PGI-IA</h1>
                    <button id="toggleSidebar" class="text-white hover:bg-gray-800 p-2 rounded">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>

                <nav class="space-y-2 flex-1">
                    <button class="sidebar-item active" data-tab="dashboard">
                        <i data-lucide="bar-chart-3"></i>
                        <span>Tableau de bord</span>
                    </button>
                    <button class="sidebar-item" data-tab="projects">
                        <i data-lucide="file-text"></i>
                        <span>Projets</span>
                    </button>
                    <button class="sidebar-item" data-tab="documents">
                        <i data-lucide="file-search"></i>
                        <span>Documents</span>
                    </button>
                    <button class="sidebar-item" data-tab="notes">
                        <i data-lucide="edit-3"></i>
                        <span>Notes</span>
                        <span class="badge bg-yellow-500" id="notesBadge">2</span>
                    </button>
                    <button class="sidebar-item" data-tab="photos">
                        <i data-lucide="camera"></i>
                        <span>Photos</span>
                    </button>
                    <button class="sidebar-item" data-tab="directives">
                        <i data-lucide="clipboard-list"></i>
                        <span>Directives</span>
                        <span class="badge bg-blue-500" id="directivesBadge">32</span>
                    </button>
                    <button class="sidebar-item" data-tab="plan">
                        <i data-lucide="map"></i>
                        <span>Plan Principal</span>
                    </button>
                    <button class="sidebar-item" data-tab="ai">
                        <i data-lucide="brain"></i>
                        <span>Analyses IA</span>
                    </button>
                    <button class="sidebar-item" data-tab="estimations">
                        <i data-lucide="dollar-sign"></i>
                        <span>Estimations</span>
                    </button>
                    <button class="sidebar-item relative" data-tab="emails">
                        <i data-lucide="mail"></i>
                        <span>Emails</span>
                        <span class="badge" id="emailBadge">3</span>
                    </button>
                    <button class="sidebar-item" data-tab="settings">
                        <i data-lucide="settings"></i>
                        <span>Configuration</span>
                    </button>
                </nav>

                <div class="pt-4 border-t border-gray-700">
                    <button class="sidebar-item w-full">
                        <i data-lucide="log-out"></i>
                        <span>Déconnexion</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 overflow-auto">
            <!-- Project Selector Header -->
            <div class="bg-gray-800 border-b border-gray-700 px-8 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <label class="text-sm font-medium text-gray-300">Projet actif:</label>
                        <select id="projectSelector" class="bg-gray-700 border border-gray-600 rounded-md px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="S-1086">S-1086 - Centre Culturel Kahnawake (KORLCC)</option>
                            <option value="C-24-048">C-24-048 - Place Alexis-Nihon</option>
                            <option value="C-22-011">C-22-011 - Parc Aquatique Beloeil</option>
                            <option value="E-25-001">E-25-001 - Hydro-Québec Roussillon</option>
                            <option value="C-24-089">C-24-089 - Cégep Montmorency</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="text-sm text-gray-400">Dernière sync:</span>
                        <span class="text-sm text-green-400">Il y a 2 min</span>
                    </div>
                </div>
            </div>
            <div class="p-8">
                <!-- Dashboard Tab -->
                <div id="dashboard" class="tab-content active">
                    <h2 class="text-2xl font-bold mb-6">Tableau de bord</h2>
                    
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4 mb-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-3 rounded-lg bg-blue-100 text-blue-600">
                                    <i data-lucide="file-text" class="w-6 h-6"></i>
                                </div>
                                <span class="text-sm font-medium text-green-600">+12%</span>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-900" id="activeProjectsCount">12</h3>
                            <p class="text-sm text-gray-600 mt-1">Projets actifs</p>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-3 rounded-lg bg-green-100 text-green-600">
                                    <i data-lucide="dollar-sign" class="w-6 h-6"></i>
                                </div>
                                <span class="text-sm font-medium text-green-600">+8%</span>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-900">12</h3>
                            <p class="text-sm text-gray-600 mt-1">Estimations</p>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-3 rounded-lg bg-purple-100 text-purple-600">
                                    <i data-lucide="file-search" class="w-6 h-6"></i>
                                </div>
                                <span class="text-sm font-medium text-green-600">+24%</span>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-900" id="documentsCount">3,247</h3>
                            <p class="text-sm text-gray-600 mt-1">Documents</p>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-3 rounded-lg bg-orange-100 text-orange-600">
                                    <i data-lucide="brain" class="w-6 h-6"></i>
                                </div>
                                <span class="text-sm font-medium text-green-600">+18%</span>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-900">1247</h3>
                            <p class="text-sm text-gray-600 mt-1">Analyses IA</p>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-3 rounded-lg bg-green-100 text-green-600">
                                    <i data-lucide="trending-up" class="w-6 h-6"></i>
                                </div>
                                <span class="text-sm font-medium text-green-600">+15%</span>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-900" id="monthlyRevenue">1,250,000$</h3>
                            <p class="text-sm text-gray-600 mt-1">CA mensuel</p>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-3 rounded-lg bg-blue-100 text-blue-600">
                                    <i data-lucide="zap" class="w-6 h-6"></i>
                                </div>
                                <span class="text-sm font-medium text-green-600">+2%</span>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-900">94.5%</h3>
                            <p class="text-sm text-gray-600 mt-1">Précision IA</p>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Revenus mensuels</h3>
                            <div style="height: 300px;">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Répartition des projets</h3>
                            <div style="height: 300px;">
                                <canvas id="projectChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Projects Table -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6 border-b">
                            <h3 class="text-lg font-semibold">Projets récents</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nom</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Client</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Progression</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valeur</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 text-sm font-medium text-gray-900">S-1086</td>
                                        <td class="px-6 py-4 text-sm text-gray-900">Musée Kahnawake</td>
                                        <td class="px-6 py-4 text-sm text-gray-500">Ville de Kahnawake</td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center">
                                                <div class="w-32 bg-gray-200 rounded-full h-2 mr-2">
                                                    <div class="bg-blue-600 h-2 rounded-full" style="width: 75%"></div>
                                                </div>
                                                <span class="text-sm text-gray-600">75%</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-900">$450,000</td>
                                        <td class="px-6 py-4 text-sm">
                                            <div class="flex space-x-2">
                                                <button class="text-blue-600 hover:text-blue-800">
                                                    <i data-lucide="eye" class="w-4 h-4"></i>
                                                </button>
                                                <button class="text-green-600 hover:text-green-800">
                                                    <i data-lucide="edit" class="w-4 h-4"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 text-sm font-medium text-gray-900">C-24-048</td>
                                        <td class="px-6 py-4 text-sm text-gray-900">Place Alexis-Nihon</td>
                                        <td class="px-6 py-4 text-sm text-gray-500">Cominar REIT</td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center">
                                                <div class="w-32 bg-gray-200 rounded-full h-2 mr-2">
                                                    <div class="bg-blue-600 h-2 rounded-full" style="width: 45%"></div>
                                                </div>
                                                <span class="text-sm text-gray-600">45%</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-900">$680,000</td>
                                        <td class="px-6 py-4 text-sm">
                                            <div class="flex space-x-2">
                                                <button class="text-blue-600 hover:text-blue-800">
                                                    <i data-lucide="eye" class="w-4 h-4"></i>
                                                </button>
                                                <button class="text-green-600 hover:text-green-800">
                                                    <i data-lucide="edit" class="w-4 h-4"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Emails Tab -->
                <div id="emails" class="tab-content">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Emails</h2>
                        <div class="flex space-x-4">
                            <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center space-x-2">
                                <i data-lucide="refresh-cw" class="w-5 h-5"></i>
                                <span>Synchroniser</span>
                            </button>
                            <button class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center space-x-2">
                                <i data-lucide="mail" class="w-5 h-5"></i>
                                <span>Composer</span>
                            </button>
                        </div>
                    </div>

                    <!-- Email Filters -->
                    <div class="bg-white rounded-lg shadow p-4 mb-6">
                        <div class="flex items-center space-x-4">
                            <div class="flex-1">
                                <div class="relative">
                                    <i data-lucide="search" class="absolute left-3 top-3 text-gray-400 w-5 h-5"></i>
                                    <input type="text" placeholder="Rechercher dans les emails..." 
                                           class="w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                            </div>
                            <select class="border rounded-lg px-4 py-2">
                                <option>Tous les emails</option>
                                <option>Non lus</option>
                                <option>Directives</option>
                                <option>Plans</option>
                                <option>Changements</option>
                                <option>Questions</option>
                            </select>
                            <select class="border rounded-lg px-4 py-2">
                                <option>Tous les projets</option>
                                <option>S-1086 - Kahnawake</option>
                                <option>C-24-048 - Alexis-Nihon</option>
                            </select>
                            <button class="border rounded-lg px-4 py-2 hover:bg-gray-50">
                                <i data-lucide="filter" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Email Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-white rounded-lg shadow p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">Total emails</p>
                                    <p class="text-2xl font-bold">127</p>
                                </div>
                                <div class="p-3 bg-blue-100 rounded-lg">
                                    <i data-lucide="mail" class="w-6 h-6 text-blue-600"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">Non lus</p>
                                    <p class="text-2xl font-bold text-red-600">3</p>
                                </div>
                                <div class="p-3 bg-red-100 rounded-lg">
                                    <i data-lucide="mail-open" class="w-6 h-6 text-red-600"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">Traités aujourd'hui</p>
                                    <p class="text-2xl font-bold text-green-600">12</p>
                                </div>
                                <div class="p-3 bg-green-100 rounded-lg">
                                    <i data-lucide="check-circle" class="w-6 h-6 text-green-600"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">En attente</p>
                                    <p class="text-2xl font-bold text-orange-600">5</p>
                                </div>
                                <div class="p-3 bg-orange-100 rounded-lg">
                                    <i data-lucide="clock" class="w-6 h-6 text-orange-600"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Email List -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Email List Column -->
                        <div class="lg:col-span-2">
                            <div class="bg-white rounded-lg shadow">
                                <div class="p-4 border-b">
                                    <h3 class="font-semibold">Boîte de réception</h3>
                                </div>
                                <div class="divide-y">
                                    <!-- Email Item 1 - Non lu -->
                                    <div class="p-4 hover:bg-gray-50 cursor-pointer email-item email-priority-high">
                                        <div class="flex items-start space-x-3">
                                            <input type="checkbox" class="mt-1">
                                            <div class="flex-1">
                                                <div class="flex items-center justify-between">
                                                    <div class="flex items-center space-x-2">
                                                        <span class="font-semibold text-gray-900">Architecte XYZ</span>
                                                        <span class="bg-red-100 text-red-800 text-xs px-2 py-0.5 rounded">Non lu</span>
                                                        <span class="bg-purple-100 text-purple-800 text-xs px-2 py-0.5 rounded">Directive</span>
                                                    </div>
                                                    <span class="text-sm text-gray-500">Il y a 5 min</span>
                                                </div>
                                                <h4 class="font-medium mt-1">⚡ Directive CD-203 - Modification urgente éclairage</h4>
                                                <p class="text-sm text-gray-600 mt-1">Bonjour, Suite à notre réunion de ce matin, voici la directive pour modifier le système d'éclairage du hall principal...</p>
                                                <div class="flex items-center space-x-4 mt-2 text-sm">
                                                    <span class="text-gray-500">Projet: S-1086</span>
                                                    <span class="text-orange-600 font-medium">Priorité haute</span>
                                                    <button class="text-blue-600 hover:underline">Traiter automatiquement</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Email Item 2 - Non lu -->
                                    <div class="p-4 hover:bg-gray-50 cursor-pointer email-item email-priority-normal">
                                        <div class="flex items-start space-x-3">
                                            <input type="checkbox" class="mt-1">
                                            <div class="flex-1">
                                                <div class="flex items-center justify-between">
                                                    <div class="flex items-center space-x-2">
                                                        <span class="font-semibold text-gray-900">Ingénieur ABC</span>
                                                        <span class="bg-red-100 text-red-800 text-xs px-2 py-0.5 rounded">Non lu</span>
                                                        <span class="bg-blue-100 text-blue-800 text-xs px-2 py-0.5 rounded">Plan</span>
                                                    </div>
                                                    <span class="text-sm text-gray-500">Il y a 23 min</span>
                                                </div>
                                                <h4 class="font-medium mt-1">📐 Rev.3 Plan E-101 - Distribution électrique</h4>
                                                <p class="text-sm text-gray-600 mt-1">Veuillez trouver en pièce jointe la révision 3 du plan de distribution électrique E-101 avec les modifications demandées...</p>
                                                <div class="flex items-center space-x-4 mt-2 text-sm">
                                                    <span class="text-gray-500">Projet: C-24-048</span>
                                                    <span class="flex items-center text-gray-600">
                                                        <i data-lucide="paperclip" class="w-4 h-4 mr-1"></i>
                                                        2 fichiers
                                                    </span>
                                                    <button class="text-blue-600 hover:underline">Analyser avec IA</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Email Item 3 - Non lu -->
                                    <div class="p-4 hover:bg-gray-50 cursor-pointer email-item email-priority-normal">
                                        <div class="flex items-start space-x-3">
                                            <input type="checkbox" class="mt-1">
                                            <div class="flex-1">
                                                <div class="flex items-center justify-between">
                                                    <div class="flex items-center space-x-2">
                                                        <span class="font-semibold text-gray-900">Client Kahnawake</span>
                                                        <span class="bg-red-100 text-red-800 text-xs px-2 py-0.5 rounded">Non lu</span>
                                                        <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-0.5 rounded">Question</span>
                                                    </div>
                                                    <span class="text-sm text-gray-500">Il y a 45 min</span>
                                                </div>
                                                <h4 class="font-medium mt-1">❓ Question sur l'estimation des coûts supplémentaires</h4>
                                                <p class="text-sm text-gray-600 mt-1">Pouvez-vous clarifier les coûts additionnels mentionnés dans votre dernière estimation? Particulièrement pour...</p>
                                                <div class="flex items-center space-x-4 mt-2 text-sm">
                                                    <span class="text-gray-500">Projet: S-1086</span>
                                                    <button class="text-blue-600 hover:underline">Suggérer réponse</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Email Item 4 - Lu -->
                                    <div class="p-4 hover:bg-gray-50 cursor-pointer email-item email-priority-low opacity-75">
                                        <div class="flex items-start space-x-3">
                                            <input type="checkbox" class="mt-1">
                                            <div class="flex-1">
                                                <div class="flex items-center justify-between">
                                                    <div class="flex items-center space-x-2">
                                                        <span class="text-gray-700">Fournisseur DEF</span>
                                                        <span class="bg-green-100 text-green-800 text-xs px-2 py-0.5 rounded">Traité</span>
                                                    </div>
                                                    <span class="text-sm text-gray-500">Hier</span>
                                                </div>
                                                <h4 class="text-gray-700 mt-1">Confirmation de livraison - Matériel électrique</h4>
                                                <p class="text-sm text-gray-500 mt-1">La livraison du matériel électrique commandé est confirmée pour le 15 juillet 2025...</p>
                                                <div class="flex items-center space-x-4 mt-2 text-sm">
                                                    <span class="text-gray-500">Projet: C-24-048</span>
                                                    <span class="text-green-600">✓ Auto-classé</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Email Actions & AI Panel -->
                        <div class="space-y-6">
                            <!-- Actions rapides -->
                            <div class="bg-white rounded-lg shadow p-6">
                                <h3 class="font-semibold mb-4">Actions rapides</h3>
                                <div class="space-y-3">
                                    <button class="w-full text-left p-3 border rounded-lg hover:bg-gray-50 flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <i data-lucide="file-plus" class="w-5 h-5 text-blue-600"></i>
                                            <span>Créer directive</span>
                                        </div>
                                        <i data-lucide="chevron-right" class="w-4 h-4 text-gray-400"></i>
                                    </button>
                                    <button class="w-full text-left p-3 border rounded-lg hover:bg-gray-50 flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <i data-lucide="calculator" class="w-5 h-5 text-green-600"></i>
                                            <span>Calculer impact</span>
                                        </div>
                                        <i data-lucide="chevron-right" class="w-4 h-4 text-gray-400"></i>
                                    </button>
                                    <button class="w-full text-left p-3 border rounded-lg hover:bg-gray-50 flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <i data-lucide="reply" class="w-5 h-5 text-purple-600"></i>
                                            <span>Réponse auto</span>
                                        </div>
                                        <i data-lucide="chevron-right" class="w-4 h-4 text-gray-400"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Classification IA -->
                            <div class="bg-white rounded-lg shadow p-6">
                                <h3 class="font-semibold mb-4">Classification IA</h3>
                                <div class="space-y-4">
                                    <div>
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-sm text-gray-600">Précision classification</span>
                                            <span class="text-sm font-medium">95%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-green-600 h-2 rounded-full" style="width: 95%"></div>
                                        </div>
                                    </div>
                                    <div class="text-sm space-y-2">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Emails classés</span>
                                            <span class="font-medium">124/127</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Actions auto</span>
                                            <span class="font-medium">89</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Temps économisé</span>
                                            <span class="font-medium">4.2h/sem</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Règles actives -->
                            <div class="bg-white rounded-lg shadow p-6">
                                <h3 class="font-semibold mb-4">Règles actives</h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between p-2 bg-green-50 rounded">
                                        <span class="text-sm">Auto-créer directives</span>
                                        <input type="checkbox" checked class="toggle">
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-blue-50 rounded">
                                        <span class="text-sm">Analyser plans PDF</span>
                                        <input type="checkbox" checked class="toggle">
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-purple-50 rounded">
                                        <span class="text-sm">Réponses suggérées</span>
                                        <input type="checkbox" checked class="toggle">
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                        <span class="text-sm">Notifications urgentes</span>
                                        <input type="checkbox" class="toggle">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other tabs remain unchanged -->
                <div id="projects" class="tab-content">
                    <h2 class="text-2xl font-bold mb-6">Tableaux de bord par projet</h2>
                    
                    <!-- Project Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Kahnawake Project Dashboard -->
                        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                            <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h3 class="text-xl font-bold">S-1086 - Centre Culturel Kahnawake</h3>
                                        <p class="text-blue-100">Client: Ville de Kahnawake</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-3xl font-bold">75%</p>
                                        <p class="text-sm text-blue-100">Progression</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="p-6">
                                <div class="grid grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <p class="text-sm text-gray-600">Valeur totale</p>
                                        <p class="text-lg font-bold">1,450,000$</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Impact net</p>
                                        <p class="text-lg font-bold text-red-600">(234,883$)</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Directives</p>
                                        <p class="text-lg font-bold">32</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">QRT actives</p>
                                        <p class="text-lg font-bold text-orange-600">3</p>
                                    </div>
                                </div>
                                
                                <div class="space-y-2">
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-gray-600">Dernière activité</span>
                                        <span class="font-medium">QRT #361 - Luminaires</span>
                                    </div>
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-gray-600">Prochain jalon</span>
                                        <span class="font-medium">Inspection finale - 15 juillet</span>
                                    </div>
                                </div>
                                
                                <button class="mt-4 w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                    Voir détails complets
                                </button>
                            </div>
                        </div>
                        
                        <!-- Alexis-Nihon Project Dashboard -->
                        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                            <div class="bg-gradient-to-r from-green-600 to-green-700 text-white p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h3 class="text-xl font-bold">C-24-048 - Place Alexis-Nihon</h3>
                                        <p class="text-green-100">Client: Cominar REIT</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-3xl font-bold">45%</p>
                                        <p class="text-sm text-green-100">Progression</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="p-6">
                                <div class="grid grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <p class="text-sm text-gray-600">Valeur totale</p>
                                        <p class="text-lg font-bold">2,680,000$</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Impact net</p>
                                        <p class="text-lg font-bold text-green-600">+77,116$</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Directives</p>
                                        <p class="text-lg font-bold">28</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">QRT actives</p>
                                        <p class="text-lg font-bold text-orange-600">2</p>
                                    </div>
                                </div>
                                
                                <div class="space-y-2">
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-gray-600">Dernière activité</span>
                                        <span class="font-medium">Plans B2 révisés</span>
                                    </div>
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-gray-600">Note importante</span>
                                        <span class="font-medium text-yellow-600">27,600$ à facturer</span>
                                    </div>
                                </div>
                                
                                <button class="mt-4 w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition-colors">
                                    Voir détails complets
                                </button>
                            </div>
                        </div>
                        
                        <!-- PAB Project Dashboard -->
                        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                            <div class="bg-gradient-to-r from-purple-600 to-purple-700 text-white p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h3 class="text-xl font-bold">C-22-011 - Parc Aquatique Beloeil</h3>
                                        <p class="text-purple-100">Client: Construction COREL</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-3xl font-bold">82%</p>
                                        <p class="text-sm text-purple-100">Progression</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="p-6">
                                <div class="grid grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <p class="text-sm text-gray-600">Valeur totale</p>
                                        <p class="text-lg font-bold">3,200,000$</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Impact net</p>
                                        <p class="text-lg font-bold text-green-600">+188,889$</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Directives</p>
                                        <p class="text-lg font-bold">45</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">QRT actives</p>
                                        <p class="text-lg font-bold text-green-600">0</p>
                                    </div>
                                </div>
                                
                                <div class="space-y-2">
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-gray-600">Dernière activité</span>
                                        <span class="font-medium">Tests systèmes complétés</span>
                                    </div>
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-gray-600">Phase actuelle</span>
                                        <span class="font-medium">Mise en service</span>
                                    </div>
                                </div>
                                
                                <button class="mt-4 w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition-colors">
                                    Voir détails complets
                                </button>
                            </div>
                        </div>
                        
                        <!-- Other Projects Summary -->
                        <div class="bg-gray-100 rounded-lg p-6 flex items-center justify-center">
                            <div class="text-center">
                                <i data-lucide="folder-plus" class="w-12 h-12 text-gray-400 mx-auto mb-3"></i>
                                <h4 class="text-lg font-medium text-gray-700 mb-2">Autres projets actifs</h4>
                                <p class="text-sm text-gray-600 mb-4">2 projets supplémentaires en cours</p>
                                <button class="text-blue-600 hover:text-blue-700 font-medium">Voir tous les projets →</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Global Project Stats -->
                    <div class="mt-8 bg-gray-900 text-white rounded-lg p-6">
                        <h3 class="text-lg font-bold mb-4">Statistiques globales tous projets</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                            <div>
                                <p class="text-3xl font-bold">12</p>
                                <p class="text-gray-400">Projets actifs</p>
                            </div>
                            <div>
                                <p class="text-3xl font-bold">45.7M$</p>
                                <p class="text-gray-400">Valeur totale</p>
                            </div>
                            <div>
                                <p class="text-3xl font-bold">487</p>
                                <p class="text-gray-400">Directives totales</p>
                            </div>
                            <div>
                                <p class="text-3xl font-bold">94.5%</p>
                                <p class="text-gray-400">Taux de satisfaction</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="documents" class="tab-content">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Documents</h2>
                        <button id="uploadBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg flex items-center">
                            <i data-lucide="upload" class="w-5 h-5 mr-2"></i>
                            Upload PDF
                        </button>
                    </div>
                    
                    <!-- Zone d'upload -->
                    <div id="uploadZone" class="bg-white rounded-lg shadow p-8 mb-6 border-2 border-dashed border-gray-300 hover:border-blue-400 transition-colors">
                        <div class="text-center">
                            <i data-lucide="file-text" class="w-16 h-16 text-gray-400 mx-auto mb-4"></i>
                            <h3 class="text-xl font-medium mb-2">Glissez-déposez vos plans PDF ici</h3>
                            <p class="text-gray-600 mb-4">ou cliquez pour sélectionner des fichiers</p>
                            <input type="file" id="fileInput" multiple accept=".pdf" class="hidden">
                            <button id="selectFiles" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg">
                                Sélectionner des fichiers
                            </button>
                        </div>
                    </div>
                    
                    <!-- Liste des documents -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6 border-b">
                            <h3 class="text-lg font-semibold">Documents récents</h3>
                        </div>
                        <div id="documentsList" class="divide-y divide-gray-200">
                            <!-- Les documents apparaîtront ici -->
                        </div>
                    </div>
                </div>

                <div id="notes" class="tab-content">
                    <h2 class="text-2xl font-bold mb-6">Notes intelligentes</h2>
                    
                    <!-- Notes Header -->
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-semibold">Système de notes avec reformulation IA</h3>
                                <p class="text-sm text-gray-600 mt-1">Écrivez vos notes terrain, l'IA les reformule professionnellement</p>
                            </div>
                            <button class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg flex items-center">
                                <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                                Nouvelle note
                            </button>
                        </div>
                    </div>

                    <!-- Notes List -->
                    <div class="space-y-4" id="notesList">
                        <!-- Note 1 -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center">
                                    <span class="text-sm font-medium px-3 py-1 bg-purple-100 text-purple-700 rounded-full">Technique</span>
                                    <span class="text-sm text-gray-500 ml-3">11 juillet 2025, 10:30</span>
                                </div>
                                <button class="text-green-600 hover:text-green-700 text-sm font-medium">Approuvée ✓</button>
                            </div>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                <div>
                                    <h4 class="text-sm font-medium text-gray-700 mb-2">Note originale:</h4>
                                    <p class="text-sm text-gray-600 italic">Problème détecté conduits 2e étage près escalier nord. Conflit avec structure acier. Voir avec ingénieur.</p>
                                </div>
                                <div>
                                    <h4 class="text-sm font-medium text-gray-700 mb-2">Reformulation IA:</h4>
                                    <p class="text-sm text-gray-900"><strong>Conflit détecté</strong>: Intersection conduits électriques/structure acier au 2e étage (secteur nord). <strong>Action requise</strong>: Consultation ingénieur structure pour solution de contournement.</p>
                                </div>
                            </div>
                            <div class="mt-4 flex items-center text-sm text-gray-500">
                                <i data-lucide="map-pin" class="w-4 h-4 mr-1"></i>
                                Projet: S-1086 - Centre Culturel Kahnawake
                            </div>
                        </div>

                        <!-- Note 2 -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center">
                                    <span class="text-sm font-medium px-3 py-1 bg-blue-100 text-blue-700 rounded-full">Client</span>
                                    <span class="text-sm text-gray-500 ml-3">11 juillet 2025, 09:15</span>
                                </div>
                                <button class="text-yellow-600 hover:text-yellow-700 text-sm font-medium">En attente d'approbation</button>
                            </div>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                <div>
                                    <h4 class="text-sm font-medium text-gray-700 mb-2">Note originale:</h4>
                                    <p class="text-sm text-gray-600 italic">Client veut ajouter prises USB dans salles réunion B2. Pas dans plans originaux.</p>
                                </div>
                                <div>
                                    <h4 class="text-sm font-medium text-gray-700 mb-2">Reformulation IA:</h4>
                                    <p class="text-sm text-gray-900"><strong>Demande client</strong>: Installation prises USB-C dans salles de réunion niveau B2. <strong>Impact</strong>: Modification plans électriques + nouvelle directive de changement requise.</p>
                                </div>
                            </div>
                            <div class="mt-4 flex items-center text-sm text-gray-500">
                                <i data-lucide="map-pin" class="w-4 h-4 mr-1"></i>
                                Projet: C-24-048 - Place Alexis-Nihon
                            </div>
                        </div>
                    </div>
                </div>

                <div id="photos" class="tab-content">
                    <h2 class="text-2xl font-bold mb-6">Photos géolocalisées</h2>
                    
                    <!-- Upload Zone -->
                    <div class="bg-white rounded-lg shadow p-8 mb-6 border-2 border-dashed border-gray-300 hover:border-blue-400 transition-colors">
                        <div class="text-center">
                            <i data-lucide="upload-cloud" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
                            <h3 class="text-lg font-medium mb-2">Téléverser des photos du chantier</h3>
                            <p class="text-sm text-gray-600 mb-4">Les photos iPhone conservent les coordonnées GPS qui seront automatiquement extraites</p>
                            <button class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg">
                                Choisir des photos
                            </button>
                        </div>
                    </div>

                    <!-- Photos Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Photo 1 -->
                        <div class="bg-white rounded-lg shadow overflow-hidden">
                            <img src="/api/placeholder/400/300" alt="Installation panneaux" class="w-full h-48 object-cover">
                            <div class="p-4">
                                <h4 class="font-medium mb-1">Installation panneaux électriques</h4>
                                <p class="text-sm text-gray-600 mb-3">Salle mécanique - Kahnawake</p>
                                <div class="space-y-1 text-sm">
                                    <div class="flex items-center text-gray-500">
                                        <i data-lucide="calendar" class="w-4 h-4 mr-2"></i>
                                        10 juillet 2025, 14:23
                                    </div>
                                    <div class="flex items-center text-gray-500">
                                        <i data-lucide="map-pin" class="w-4 h-4 mr-2"></i>
                                        45.4003°N, 73.8237°O
                                    </div>
                                    <div class="flex items-center text-blue-600">
                                        <i data-lucide="map" class="w-4 h-4 mr-2"></i>
                                        Position sur plan: X:234, Y:567
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Photo 2 -->
                        <div class="bg-white rounded-lg shadow overflow-hidden">
                            <img src="/api/placeholder/400/300" alt="Conduits principaux" class="w-full h-48 object-cover">
                            <div class="p-4">
                                <h4 class="font-medium mb-1">Conduits principaux</h4>
                                <p class="text-sm text-gray-600 mb-3">Entrée bassin - PAB</p>
                                <div class="space-y-1 text-sm">
                                    <div class="flex items-center text-gray-500">
                                        <i data-lucide="calendar" class="w-4 h-4 mr-2"></i>
                                        10 juillet 2025, 15:45
                                    </div>
                                    <div class="flex items-center text-gray-500">
                                        <i data-lucide="map-pin" class="w-4 h-4 mr-2"></i>
                                        45.5807°N, 73.3265°O
                                    </div>
                                    <div class="flex items-center text-blue-600">
                                        <i data-lucide="map" class="w-4 h-4 mr-2"></i>
                                        Position sur plan: X:456, Y:789
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="directives" class="tab-content">
                    <h2 class="text-2xl font-bold mb-6">Directives reçues & QRT</h2>
                    
                    <!-- Platform Integration Info -->
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                        <div class="flex items-center">
                            <i data-lucide="info" class="w-5 h-5 text-blue-600 mr-2"></i>
                            <p class="text-sm text-blue-800">
                                <strong>Intégration automatique:</strong> QRT via Procore ou Autodesk Build selon l'entrepreneur général
                            </p>
                        </div>
                    </div>
                    
                    <!-- Quick Access to Project Tracking -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <a href="file:///C:/Users/fvegi/OneDrive/Desktop/Kahnawake%20suivi%20directive.html" 
                           target="_blank"
                           class="bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg p-6 hover:from-blue-700 hover:to-blue-800 transition-all transform hover:scale-105 shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-lg font-bold mb-2">Centre Culturel Kahnawake</h3>
                                    <p class="text-blue-100 text-sm">Accéder au suivi détaillé des directives</p>
                                </div>
                                <i data-lucide="external-link" class="w-8 h-8"></i>
                            </div>
                        </a>
                        
                        <a href="file:///C:/Users/fvegi/OneDrive/Desktop/suivi%20directive%20alexis%20nihon.html" 
                           target="_blank"
                           class="bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg p-6 hover:from-green-700 hover:to-green-800 transition-all transform hover:scale-105 shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-lg font-bold mb-2">Place Alexis-Nihon</h3>
                                    <p class="text-green-100 text-sm">Accéder au suivi détaillé des directives</p>
                                </div>
                                <i data-lucide="external-link" class="w-8 h-8"></i>
                            </div>
                        </a>
                    </div>
                    
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-sm font-medium text-gray-600">Directives reçues</h3>
                            <p class="text-2xl font-bold text-blue-600 mt-1">32</p>
                            <p class="text-sm text-gray-500 mt-2">Ce mois-ci</p>
                        </div>
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-sm font-medium text-gray-600">QRT actives</h3>
                            <p class="text-2xl font-bold text-orange-600 mt-1">7</p>
                            <p class="text-sm text-gray-500 mt-2">En attente réponse</p>
                        </div>
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-sm font-medium text-gray-600">Total Extras</h3>
                            <p class="text-2xl font-bold text-green-600 mt-1">155 940$</p>
                            <p class="text-sm text-gray-500 mt-2">Approuvés</p>
                        </div>
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-sm font-medium text-gray-600">Total Crédits</h3>
                            <p class="text-2xl font-bold text-red-600 mt-1">(390 824$)</p>
                            <p class="text-sm text-gray-500 mt-2">Approuvés</p>
                        </div>
                    </div>

                    <!-- Directives Table -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold">Directives actives</h3>
                                <div class="flex space-x-2">
                                    <input type="text" placeholder="Rechercher..." class="px-4 py-2 border border-gray-300 rounded-lg text-sm">
                                    <select class="px-4 py-2 border border-gray-300 rounded-lg text-sm">
                                        <option>Tous les statuts</option>
                                        <option>À préparer</option>
                                        <option>Soumis</option>
                                        <option>Approuvé</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"># Directive</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Montant</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="directivesTableBody">
                                    <!-- Les directives seront chargées dynamiquement -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="plan" class="tab-content">
                    <h2 class="text-2xl font-bold mb-6">Plan principal avec marqueurs</h2>
                    
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="mb-4 flex items-center justify-between">
                            <h3 class="text-lg font-semibold">Plan du projet actif</h3>
                            <div class="flex space-x-2">
                                <button class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium">
                                    <i data-lucide="zoom-in" class="w-4 h-4 inline mr-1"></i>
                                    Zoom
                                </button>
                                <button class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium">
                                    <i data-lucide="layers" class="w-4 h-4 inline mr-1"></i>
                                    Calques
                                </button>
                                <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium">
                                    <i data-lucide="map-pin" class="w-4 h-4 inline mr-1"></i>
                                    Ajouter marqueur
                                </button>
                            </div>
                        </div>
                        
                        <!-- Plan Container avec zoom et pan -->
                        <div class="relative bg-gray-900 rounded-lg overflow-hidden" style="height: 700px; cursor: grab;" id="planContainer">
                            <!-- Plan Viewport (scrollable) -->
                            <div id="planViewport" class="absolute inset-0 overflow-hidden">
                                <!-- Plan Image avec transformation -->
                                <div id="planImageWrapper" style="transform-origin: center center; transition: transform 0.1s ease-out;">
                                    <img src="assets/plans/EC-M-RC01-TELECOM-CONDUITS-PATH---GROUND-LEVEL-Rev.1_page_1_web.jpg" 
                                         alt="Plan EC-M-RC01 TELECOM CONDUITS PATH" 
                                         id="planImage"
                                         data-low-res="assets/plans/EC-M-RC01-TELECOM-CONDUITS-PATH---GROUND-LEVEL-Rev.1_page_1_web.jpg"
                                         data-high-res="assets/plans/EC-M-RC01-TELECOM-CONDUITS-PATH---GROUND-LEVEL-Rev.1_page_1.png"
                                         style="user-select: none; -webkit-user-drag: none; display: block;"
                                         onerror="this.onerror=null; this.style.display='none'; console.error('Plan image not found');">
                                    
                                    <!-- Overlay sombre pour améliorer la visibilité des marqueurs -->
                                    <div class="absolute inset-0 bg-black bg-opacity-20" style="pointer-events: none;"></div>
                                    
                                    <!-- Zone active -->
                                    <div class="absolute" style="top: 25%; left: 20%; width: 15%; height: 20%; border: 2px dashed #3B82F6; border-radius: 8px; background: rgba(59, 130, 246, 0.1);">
                                        <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-3 py-1 rounded text-xs whitespace-nowrap">
                                            Zone active: Salle mécanique
                                        </div>
                                    </div>
                            
                            <!-- Fallback background si l'image ne charge pas -->
                            <div class="absolute inset-0 bg-gray-800" style="z-index: -1;">
                                <div class="flex items-center justify-center h-full text-gray-400">
                                    <div class="text-center">
                                        <i data-lucide="image-off" class="w-16 h-16 mx-auto mb-4"></i>
                                        <p>Plan en cours de chargement...</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Titre du plan -->
                            <div class="absolute top-4 left-4 bg-black bg-opacity-80 text-white px-4 py-3 rounded-lg z-10">
                                <h3 class="font-bold text-lg">PLAN EC-M-RC01</h3>
                                <p class="text-sm text-gray-300">Centre Culturel Kahnawake - Conduits Télécom/Chemin de câbles - Rez-de-chaussée Rev.1</p>
                            </div>
                            
                                    <!-- Marqueurs Container - se déplace avec l'image -->
                                    <div class="absolute inset-0" style="pointer-events: auto;">
                                        <!-- Marqueur 1: Panneaux électriques -->
                                        <div class="absolute cursor-pointer group" style="top: 30%; left: 25%;">
                                            <div class="absolute -top-2 -left-2 w-10 h-10 bg-blue-500 rounded-full animate-ping opacity-30"></div>
                                            <div class="relative">
                                                <i data-lucide="map-pin" class="w-6 h-6 text-blue-600"></i>
                                            </div>
                                            <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50">
                                                Installation panneaux électriques - Salle mécanique
                                            </div>
                                        </div>
                                        
                                        <!-- Marqueur 2: Photo géolocalisée -->
                                        <div class="absolute cursor-pointer group" style="top: 45%; left: 60%;">
                                            <div class="absolute -top-2 -left-2 w-10 h-10 bg-green-500 rounded-full animate-ping opacity-30"></div>
                                            <div class="relative">
                                                <i data-lucide="camera" class="w-6 h-6 text-green-600"></i>
                                            </div>
                                            <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50">
                                                Photo: Conduits principaux - 10/07/2025 14:23
                                            </div>
                                        </div>
                                        
                                        <!-- Marqueur 3: Zone problème -->
                                        <div class="absolute cursor-pointer group" style="top: 65%; left: 40%;">
                                            <div class="absolute -top-2 -left-2 w-10 h-10 bg-orange-500 rounded-full animate-ping opacity-30"></div>
                                            <div class="relative">
                                                <i data-lucide="alert-triangle" class="w-6 h-6 text-orange-600"></i>
                                            </div>
                                            <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50">
                                                Conflit: Conduits vs structure acier - 2e étage
                                            </div>
                                        </div>
                                        
                                        <!-- Marqueur 4: QRT Active -->
                                        <div class="absolute cursor-pointer group" style="top: 20%; left: 75%;">
                                            <div class="absolute -top-2 -left-2 w-10 h-10 bg-red-500 rounded-full animate-ping opacity-30"></div>
                                            <div class="relative">
                                                <i data-lucide="help-circle" class="w-6 h-6 text-red-600"></i>
                                            </div>
                                            <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50">
                                                QRT #361: Luminaire L3 et K - En attente
                                            </div>
                                        </div>
                                        
                                        <!-- Marqueur 5: Directive approuvée -->
                                        <div class="absolute cursor-pointer group" style="top: 80%; left: 20%;">
                                            <div class="absolute -top-2 -left-2 w-10 h-10 bg-green-500 rounded-full animate-ping opacity-30"></div>
                                            <div class="relative">
                                                <i data-lucide="check-circle" class="w-6 h-6 text-green-600"></i>
                                            </div>
                                            <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50">
                                                CO-ME-028: Valve supervisée - Complété
                                            </div>
                                        </div>
                                        
                                        <!-- Marqueur 6: Travaux en cours -->
                                        <div class="absolute cursor-pointer group" style="top: 50%; left: 35%;">
                                            <div class="absolute -top-2 -left-2 w-10 h-10 bg-yellow-500 rounded-full animate-ping opacity-30"></div>
                                            <div class="relative">
                                                <i data-lucide="hard-hat" class="w-6 h-6 text-yellow-600"></i>
                                            </div>
                                            <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50">
                                                Installation luminaires V1-V2 en cours
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Info projet -->
                            <div class="absolute bottom-4 right-4 bg-black bg-opacity-80 text-white px-4 py-2 rounded-lg text-sm">
                                <div class="flex items-center space-x-4">
                                    <span class="flex items-center">
                                        <span class="w-3 h-3 bg-blue-500 rounded-full mr-2"></span>
                                        Points d'intérêt
                                    </span>
                                    <span class="flex items-center">
                                        <span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>
                                        Photos/Complété
                                    </span>
                                    <span class="flex items-center">
                                        <span class="w-3 h-3 bg-orange-500 rounded-full mr-2"></span>
                                        Problèmes
                                    </span>
                                    <span class="flex items-center">
                                        <span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span>
                                        QRT urgent
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Legend -->
                        <div class="mt-4 flex items-center space-x-6 text-sm">
                            <div class="flex items-center">
                                <i data-lucide="map-pin" class="w-4 h-4 text-blue-600 mr-2"></i>
                                <span>Points d'intérêt</span>
                            </div>
                            <div class="flex items-center">
                                <i data-lucide="camera" class="w-4 h-4 text-green-600 mr-2"></i>
                                <span>Photos géolocalisées</span>
                            </div>
                            <div class="flex items-center">
                                <i data-lucide="alert-triangle" class="w-4 h-4 text-orange-600 mr-2"></i>
                                <span>Zones à problème</span>
                            </div>
                        </div>
                        
                        <!-- Zoom Controls -->
                        <div class="absolute bottom-4 left-4 bg-black bg-opacity-80 text-white px-3 py-2 rounded-lg flex items-center space-x-2">
                            <button onclick="zoomIn()" class="hover:bg-gray-700 p-1 rounded">
                                <i data-lucide="zoom-in" class="w-5 h-5"></i>
                            </button>
                            <span id="zoomLevel" class="text-sm">100%</span>
                            <button onclick="zoomOut()" class="hover:bg-gray-700 p-1 rounded">
                                <i data-lucide="zoom-out" class="w-5 h-5"></i>
                            </button>
                            <button onclick="resetZoom()" class="hover:bg-gray-700 p-1 rounded ml-2">
                                <i data-lucide="maximize-2" class="w-5 h-5"></i>
                            </button>
                        </div>
                        
                        <!-- Instructions -->
                        <div class="absolute bottom-4 right-4 bg-black bg-opacity-80 text-white px-3 py-2 rounded-lg text-xs">
                            <p>🖱️ Cliquer-glisser pour déplacer | 🔍 Molette pour zoomer</p>
                        </div>
                    </div>
                    
                    <!-- Plan Navigation Script -->
                    <script>
                        let scale = 1;
                        let translateX = 0;
                        let translateY = 0;
                        let isDragging = false;
                        let startX, startY;
                        
                        const planContainer = document.getElementById('planContainer');
                        const planImageWrapper = document.getElementById('planImageWrapper');
                        const zoomLevelDisplay = document.getElementById('zoomLevel');
                        
                        let highResLoaded = false;
                        
                        function updateTransform() {
                            planImageWrapper.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
                            zoomLevelDisplay.textContent = Math.round(scale * 100) + '%';
                            
                            // Charger haute résolution si zoom > 150%
                            if (scale > 1.5 && !highResLoaded) {
                                loadHighResImage();
                            }
                        }
                        
                        function loadHighResImage() {
                            const planImage = document.getElementById('planImage');
                            const highResSrc = planImage.getAttribute('data-high-res');
                            
                            if (highResSrc && !highResLoaded) {
                                const tempImg = new Image();
                                tempImg.onload = function() {
                                    planImage.src = highResSrc;
                                    highResLoaded = true;
                                    console.log('Image haute résolution chargée');
                                };
                                tempImg.onerror = function() {
                                    console.error('Impossible de charger l\'image haute résolution');
                                };
                                tempImg.src = highResSrc;
                            }
                        }
                        
                        function zoomIn() {
                            scale = Math.min(scale * 1.2, 5);
                            updateTransform();
                        }
                        
                        function zoomOut() {
                            scale = Math.max(scale / 1.2, 0.5);
                            updateTransform();
                        }
                        
                        function resetZoom() {
                            scale = 1;
                            translateX = 0;
                            translateY = 0;
                            updateTransform();
                        }
                        
                        // Mouse wheel zoom
                        planContainer.addEventListener('wheel', (e) => {
                            e.preventDefault();
                            if (e.deltaY < 0) {
                                zoomIn();
                            } else {
                                zoomOut();
                            }
                        });
                        
                        // Mouse drag to pan
                        planContainer.addEventListener('mousedown', (e) => {
                            isDragging = true;
                            startX = e.clientX - translateX;
                            startY = e.clientY - translateY;
                            planContainer.style.cursor = 'grabbing';
                        });
                        
                        document.addEventListener('mousemove', (e) => {
                            if (!isDragging) return;
                            e.preventDefault();
                            translateX = e.clientX - startX;
                            translateY = e.clientY - startY;
                            updateTransform();
                        });
                        
                        document.addEventListener('mouseup', () => {
                            isDragging = false;
                            planContainer.style.cursor = 'grab';
                        });
                        
                        // Touch support
                        let touchStartDistance = 0;
                        let lastTouchX = 0;
                        let lastTouchY = 0;
                        
                        planContainer.addEventListener('touchstart', (e) => {
                            if (e.touches.length === 1) {
                                isDragging = true;
                                lastTouchX = e.touches[0].clientX;
                                lastTouchY = e.touches[0].clientY;
                            } else if (e.touches.length === 2) {
                                const dx = e.touches[0].clientX - e.touches[1].clientX;
                                const dy = e.touches[0].clientY - e.touches[1].clientY;
                                touchStartDistance = Math.sqrt(dx * dx + dy * dy);
                            }
                        });
                        
                        planContainer.addEventListener('touchmove', (e) => {
                            e.preventDefault();
                            if (e.touches.length === 1 && isDragging) {
                                const deltaX = e.touches[0].clientX - lastTouchX;
                                const deltaY = e.touches[0].clientY - lastTouchY;
                                translateX += deltaX;
                                translateY += deltaY;
                                lastTouchX = e.touches[0].clientX;
                                lastTouchY = e.touches[0].clientY;
                                updateTransform();
                            } else if (e.touches.length === 2) {
                                const dx = e.touches[0].clientX - e.touches[1].clientX;
                                const dy = e.touches[0].clientY - e.touches[1].clientY;
                                const distance = Math.sqrt(dx * dx + dy * dy);
                                const scaleDelta = distance / touchStartDistance;
                                scale = Math.min(Math.max(scale * scaleDelta, 0.5), 5);
                                touchStartDistance = distance;
                                updateTransform();
                            }
                        });
                        
                        planContainer.addEventListener('touchend', () => {
                            isDragging = false;
                        });
                    
    
    // Upload PDF functionality
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const selectFilesBtn = document.getElementById('selectFiles');
    const uploadBtn = document.getElementById('uploadBtn');
    
    // Click to select files
    selectFilesBtn?.addEventListener('click', () => fileInput.click());
    uploadBtn?.addEventListener('click', () => fileInput.click());
    
    // File input change
    fileInput?.addEventListener('change', (e) => {
        handleFiles(e.target.files);
    });
    
    // Drag and drop
    uploadZone?.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('border-blue-500', 'bg-blue-50');
    });
    
    uploadZone?.addEventListener('dragleave', () => {
        uploadZone.classList.remove('border-blue-500', 'bg-blue-50');
    });
    
    uploadZone?.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('border-blue-500', 'bg-blue-50');
        handleFiles(e.dataTransfer.files);
    });
    
    // Handle files
    async function handleFiles(files) {
        for (const file of files) {
            if (file.type === 'application/pdf') {
                await uploadFile(file);
            } else {
                alert(`${file.name} n'est pas un fichier PDF`);
            }
        }
    }
    
    // Upload file
    async function uploadFile(file) {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('project_id', 'kahnawake'); // Default project
        
        // Show progress
        const progressDiv = document.createElement('div');
        progressDiv.className = 'p-4 bg-blue-50 border-l-4 border-blue-500 mb-4';
        progressDiv.innerHTML = `
            <div class="flex items-center">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-3"></div>
                <span>Upload de ${file.name}...</span>
            </div>
        `;
        document.getElementById('documentsList').prepend(progressDiv);
        
        try {
            const response = await fetch('http://localhost:5000/upload', {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                const result = await response.json();
                progressDiv.innerHTML = `
                    <div class="flex items-center text-green-600">
                        <i data-lucide="check-circle" class="w-6 h-6 mr-3"></i>
                        <span>${file.name} uploadé avec succès!</span>
                    </div>
                `;
                
                // Refresh documents list
                setTimeout(() => {
                    loadDocuments();
                }, 2000);
            } else {
                throw new Error('Upload failed');
            }
        } catch (error) {
            progressDiv.innerHTML = `
                <div class="flex items-center text-red-600">
                    <i data-lucide="x-circle" class="w-6 h-6 mr-3"></i>
                    <span>Erreur lors de l'upload de ${file.name}</span>
                </div>
            `;
        }
        
        // Re-initialize lucide icons
        lucide.createIcons();
    }
    
    // Load documents list
    
        } catch (error) {
            console.error('Error loading documents:', error);
        }
    }
</script>
                </div>

                <div id="ai" class="tab-content">
                    <h2 class="text-2xl font-bold mb-6">Analyses IA - Centre Culturel Kahnawake</h2>
                    
                    <!-- AI Analysis Summary -->
                    <div class="bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg p-6 mb-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-xl font-bold mb-2">Intelligence Artificielle au service de votre projet</h3>
                                <p class="text-purple-100">5 analyses critiques identifiées pour optimiser le projet S-1086</p>
                            </div>
                            <div class="text-center">
                                <p class="text-3xl font-bold">94.5%</p>
                                <p class="text-sm text-purple-100">Précision IA</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Analysis Cards -->
                    <div class="space-y-6">
                        <!-- Analysis 1: Budget Alert -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <div class="flex items-start space-x-4">
                                <div class="p-3 bg-red-100 rounded-lg">
                                    <i data-lucide="trending-down" class="w-6 h-6 text-red-600"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-2">
                                        <h3 class="text-lg font-bold">Alerte budgétaire: Dépassement significatif détecté</h3>
                                        <span class="px-3 py-1 bg-red-100 text-red-800 text-sm rounded-full font-medium">Urgent</span>
                                    </div>
                                    <p class="text-gray-600 mb-4">
                                        L'analyse des directives CO-ME montre un impact net négatif de <strong>234,883.64$</strong>. 
                                        Le crédit majeur de 389,778.16$ (CO-ME-16) pour modifications d'éclairage représente 26.8% du budget initial.
                                    </p>
                                    <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                        <h4 class="font-medium mb-2">Recommandations IA:</h4>
                                        <ul class="space-y-2 text-sm">
                                            <li class="flex items-start">
                                                <i data-lucide="check-circle" class="w-4 h-4 text-green-600 mr-2 mt-0.5"></i>
                                                <span>Négocier avec l'architecte pour limiter les changements d'éclairage non essentiels</span>
                                            </li>
                                            <li class="flex items-start">
                                                <i data-lucide="check-circle" class="w-4 h-4 text-green-600 mr-2 mt-0.5"></i>
                                                <span>Réviser la directive CO-ME-20 (60,966$) pour identifier des économies possibles</span>
                                            </li>
                                            <li class="flex items-start">
                                                <i data-lucide="check-circle" class="w-4 h-4 text-green-600 mr-2 mt-0.5"></i>
                                                <span>Documenter tous les changements pour réclamation potentielle</span>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-500">Basé sur l'analyse de 32 directives</span>
                                        <button class="text-blue-600 hover:text-blue-700 font-medium text-sm">Voir détails complets →</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Analysis 2: QRT Pattern -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <div class="flex items-start space-x-4">
                                <div class="p-3 bg-orange-100 rounded-lg">
                                    <i data-lucide="alert-circle" class="w-6 h-6 text-orange-600"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-2">
                                        <h3 class="text-lg font-bold">Pattern détecté: Délais de réponse QRT critiques</h3>
                                        <span class="px-3 py-1 bg-orange-100 text-orange-800 text-sm rounded-full font-medium">Important</span>
                                    </div>
                                    <p class="text-gray-600 mb-4">
                                        Les QRT sur les luminaires (V1-V2, L3, K) montrent un délai moyen de réponse de 72h. 
                                        La QRT #361 approche de son échéance (11/07) sans confirmation finale de l'architecte.
                                    </p>
                                    <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                        <h4 class="font-medium mb-2">Actions préventives suggérées:</h4>
                                        <ul class="space-y-2 text-sm">
                                            <li class="flex items-start">
                                                <i data-lucide="clock" class="w-4 h-4 text-orange-600 mr-2 mt-0.5"></i>
                                                <span>Relancer immédiatement pour la confirmation du montage luminaire K</span>
                                            </li>
                                            <li class="flex items-start">
                                                <i data-lucide="users" class="w-4 h-4 text-orange-600 mr-2 mt-0.5"></i>
                                                <span>Planifier réunion de coordination hebdomadaire avec Pageau Morel</span>
                                            </li>
                                            <li class="flex items-start">
                                                <i data-lucide="bell" class="w-4 h-4 text-orange-600 mr-2 mt-0.5"></i>
                                                <span>Activer alertes automatiques 48h avant échéance QRT</span>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-500">Pattern identifié sur 7 QRT actives</span>
                                        <button class="text-blue-600 hover:text-blue-700 font-medium text-sm">Configurer alertes →</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Analysis 3: Coordination Issue -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <div class="flex items-start space-x-4">
                                <div class="p-3 bg-yellow-100 rounded-lg">
                                    <i data-lucide="git-merge" class="w-6 h-6 text-yellow-600"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-2">
                                        <h3 class="text-lg font-bold">Conflit de coordination détecté: Mécanique vs Électrique</h3>
                                        <span class="px-3 py-1 bg-yellow-100 text-yellow-800 text-sm rounded-full font-medium">Attention</span>
                                    </div>
                                    <p class="text-gray-600 mb-4">
                                        L'analyse croisée révèle que la directive CO-ME-32 (déplacement conduits suite à modification ventilation) 
                                        aurait pu être évitée avec une meilleure coordination initiale. Coût: 2,157.30$.
                                    </p>
                                    <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                        <h4 class="font-medium mb-2">Zones à risque identifiées:</h4>
                                        <div class="grid grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <p class="font-medium text-gray-700 mb-1">2e étage - Secteur Nord</p>
                                                <p class="text-gray-600">Conflit conduits/structure acier</p>
                                            </div>
                                            <div>
                                                <p class="font-medium text-gray-700 mb-1">Salle mécanique</p>
                                                <p class="text-gray-600">Espace insuffisant panneaux</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-500">Basé sur l'analyse spatiale 3D</span>
                                        <button class="text-blue-600 hover:text-blue-700 font-medium text-sm">Voir clash detection →</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Analysis 4: Supplier Performance -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <div class="flex items-start space-x-4">
                                <div class="p-3 bg-green-100 rounded-lg">
                                    <i data-lucide="truck" class="w-6 h-6 text-green-600"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-2">
                                        <h3 class="text-lg font-bold">Opportunité: Optimisation des livraisons matériel</h3>
                                        <span class="px-3 py-1 bg-green-100 text-green-800 text-sm rounded-full font-medium">Optimisation</span>
                                    </div>
                                    <p class="text-gray-600 mb-4">
                                        L'IA a identifié que 67% des retards sont liés aux luminaires spécialisés (V1-V2, L3, K). 
                                        Recommandation: commander en avance les items avec longs délais.
                                    </p>
                                    <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                        <h4 class="font-medium mb-2">Plan d'action optimisé:</h4>
                                        <div class="space-y-3">
                                            <div class="flex items-center justify-between text-sm">
                                                <span class="flex items-center">
                                                    <i data-lucide="calendar" class="w-4 h-4 text-gray-600 mr-2"></i>
                                                    Luminaires V1-V2
                                                </span>
                                                <span class="font-medium text-orange-600">Commander avant 15/07</span>
                                            </div>
                                            <div class="flex items-center justify-between text-sm">
                                                <span class="flex items-center">
                                                    <i data-lucide="calendar" class="w-4 h-4 text-gray-600 mr-2"></i>
                                                    Panneaux sur mesure
                                                </span>
                                                <span class="font-medium text-green-600">En stock - OK</span>
                                            </div>
                                            <div class="flex items-center justify-between text-sm">
                                                <span class="flex items-center">
                                                    <i data-lucide="calendar" class="w-4 h-4 text-gray-600 mr-2"></i>
                                                    Conduits spéciaux
                                                </span>
                                                <span class="font-medium text-yellow-600">Vérifier disponibilité</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-500">Économie potentielle: 15,000$ en pénalités</span>
                                        <button class="text-blue-600 hover:text-blue-700 font-medium text-sm">Générer PO automatique →</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Analysis 5: Predictive -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <div class="flex items-start space-x-4">
                                <div class="p-3 bg-blue-100 rounded-lg">
                                    <i data-lucide="trending-up" class="w-6 h-6 text-blue-600"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-2">
                                        <h3 class="text-lg font-bold">Prédiction: Inspection finale - Points d'attention</h3>
                                        <span class="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full font-medium">15 juillet</span>
                                    </div>
                                    <p class="text-gray-600 mb-4">
                                        Basé sur l'historique de 35 projets similaires, l'IA prédit 3 points critiques pour l'inspection 
                                        du Bureau de contrôle le 15 juillet.
                                    </p>
                                    <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                        <h4 class="font-medium mb-2">Points à vérifier avant inspection:</h4>
                                        <ul class="space-y-2 text-sm">
                                            <li class="flex items-start">
                                                <span class="font-medium text-red-600 mr-2">1.</span>
                                                <span><strong>Documentation alarme incendie:</strong> S'assurer que CO-ME-028 (valve supervisée) est documentée</span>
                                            </li>
                                            <li class="flex items-start">
                                                <span class="font-medium text-orange-600 mr-2">2.</span>
                                                <span><strong>Tests d'éclairage:</strong> Compléter tests photométriques zones publiques (luminaires V)</span>
                                            </li>
                                            <li class="flex items-start">
                                                <span class="font-medium text-yellow-600 mr-2">3.</span>
                                                <span><strong>Mise à la terre:</strong> Vérifier continuité suite au retrait paratonnerre (CO-ME-05)</span>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-500">Taux de réussite prédictif: 89%</span>
                                        <button class="text-blue-600 hover:text-blue-700 font-medium text-sm">Générer checklist complète →</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AI Performance Metrics -->
                    <div class="mt-8 bg-gray-900 text-white rounded-lg p-6">
                        <h3 class="text-lg font-bold mb-4">Performance du système IA - Kahnawake</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                            <div>
                                <p class="text-3xl font-bold text-green-400">127</p>
                                <p class="text-gray-400">Emails analysés</p>
                            </div>
                            <div>
                                <p class="text-3xl font-bold text-blue-400">32</p>
                                <p class="text-gray-400">Directives traitées</p>
                            </div>
                            <div>
                                <p class="text-3xl font-bold text-yellow-400">4.2h</p>
                                <p class="text-gray-400">Temps économisé/sem</p>
                            </div>
                            <div>
                                <p class="text-3xl font-bold text-purple-400">94.5%</p>
                                <p class="text-gray-400">Précision prédictions</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="estimations" class="tab-content">
                    <h2 class="text-2xl font-bold mb-6">Estimations & Soumissions</h2>
                    
                    <!-- Estimation Process Info -->
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                        <div class="flex items-center">
                            <i data-lucide="info" class="w-5 h-5 text-blue-600 mr-2"></i>
                            <p class="text-sm text-blue-800">
                                <strong>Processus:</strong> Les projets avec préfixe "S-" sont en phase de soumission. Une fois gagnés, le "S" est retiré et ils deviennent des projets actifs.
                            </p>
                        </div>
                    </div>
                    
                    <!-- Estimation Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-sm font-medium text-gray-600">Soumissions actives</h3>
                            <p class="text-2xl font-bold text-blue-600 mt-1">8</p>
                            <p class="text-sm text-gray-500 mt-2">En cours</p>
                        </div>
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-sm font-medium text-gray-600">Valeur totale</h3>
                            <p class="text-2xl font-bold text-gray-900 mt-1">12.4M$</p>
                            <p class="text-sm text-gray-500 mt-2">Potentiel</p>
                        </div>
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-sm font-medium text-gray-600">Taux de succès</h3>
                            <p class="text-2xl font-bold text-green-600 mt-1">68%</p>
                            <p class="text-sm text-gray-500 mt-2">2025</p>
                        </div>
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-sm font-medium text-gray-600">À soumettre</h3>
                            <p class="text-2xl font-bold text-orange-600 mt-1">3</p>
                            <p class="text-sm text-gray-500 mt-2">Cette semaine</p>
                        </div>
                    </div>
                    
                    <!-- Active Estimations -->
                    <div class="bg-white rounded-lg shadow overflow-hidden mb-6">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold">Soumissions en cours</h3>
                                <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm">
                                    <i data-lucide="plus" class="w-4 h-4 inline mr-1"></i>
                                    Nouvelle soumission
                                </button>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Référence</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Projet</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Client</th>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Valeur estimée</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date soumission</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <!-- Soumission 1 - Haute priorité -->
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="text-sm font-medium text-gray-900">S-1094</span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="text-sm text-gray-900 font-medium">Centre Communautaire Laval</div>
                                            <div class="text-sm text-gray-500">Nouvelle construction</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                            Ville de Laval
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-right font-mono">
                                            2,850,000$
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="text-sm text-orange-600 font-medium">15 juillet 2025</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 py-1 text-xs font-medium rounded-full bg-orange-100 text-orange-800">
                                                En préparation
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-center text-sm">
                                            <button class="text-blue-600 hover:text-blue-900 mr-3">Éditer</button>
                                            <button class="text-green-600 hover:text-green-900">Finaliser</button>
                                        </td>
                                    </tr>
                                    
                                    <!-- Soumission 2 - En révision -->
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="text-sm font-medium text-gray-900">S-1095</span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="text-sm text-gray-900 font-medium">Tour bureaux Griffintown</div>
                                            <div class="text-sm text-gray-500">20 étages - Commercial</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                            Devimco
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-right font-mono">
                                            4,200,000$
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="text-sm text-gray-600">18 juillet 2025</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800">
                                                En révision
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-center text-sm">
                                            <button class="text-blue-600 hover:text-blue-900 mr-3">Réviser</button>
                                            <button class="text-gray-600 hover:text-gray-900">Historique</button>
                                        </td>
                                    </tr>
                                    
                                    <!-- Soumission 3 - Soumise -->
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="text-sm font-medium text-gray-900">S-1093</span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="text-sm text-gray-900 font-medium">Rénovation Hôpital St-Michel</div>
                                            <div class="text-sm text-gray-500">Aile pédiatrique</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                            CIUSSS
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-right font-mono">
                                            3,750,000$
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="text-sm text-green-600">Soumise 08/07</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 py-1 text-xs font-medium rounded-full bg-purple-100 text-purple-800">
                                                En attente
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-center text-sm">
                                            <button class="text-purple-600 hover:text-purple-900">Suivi</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Recent Conversions -->
                    <div class="bg-green-50 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-green-900 mb-4">🎉 Soumissions récemment gagnées</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between bg-white rounded-lg p-4">
                                <div class="flex items-center space-x-4">
                                    <div class="flex items-center justify-center w-12 h-12 bg-green-100 rounded-full">
                                        <i data-lucide="check" class="w-6 h-6 text-green-600"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium">S-1086 → 1086 - Centre Culturel Kahnawake</p>
                                        <p class="text-sm text-gray-600">Converti le 15 mai 2025 - Valeur: 1,450,000$</p>
                                    </div>
                                </div>
                                <span class="text-sm font-medium text-green-600">Démarrage: Juillet 2025</span>
                            </div>
                            
                            <div class="flex items-center justify-between bg-white rounded-lg p-4">
                                <div class="flex items-center space-x-4">
                                    <div class="flex items-center justify-center w-12 h-12 bg-green-100 rounded-full">
                                        <i data-lucide="check" class="w-6 h-6 text-green-600"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium">S-C-24-048 → C-24-048 - Place Alexis-Nihon</p>
                                        <p class="text-sm text-gray-600">Converti le 02 juin 2025 - Valeur: 2,680,000$</p>
                                    </div>
                                </div>
                                <span class="text-sm font-medium text-green-600">En cours: 45%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="settings" class="tab-content">
                    <h2 class="text-2xl font-bold mb-6">Configuration</h2>
                    <!-- Settings content -->
                </div>
            </div>
        </div>
    </div>

    <script src="dashboard.js">
    
    // Upload PDF functionality
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const selectFilesBtn = document.getElementById('selectFiles');
    const uploadBtn = document.getElementById('uploadBtn');
    
    // Click to select files
    selectFilesBtn?.addEventListener('click', () => fileInput.click());
    uploadBtn?.addEventListener('click', () => fileInput.click());
    
    // File input change
    fileInput?.addEventListener('change', (e) => {
        handleFiles(e.target.files);
    });
    
    // Drag and drop
    uploadZone?.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('border-blue-500', 'bg-blue-50');
    });
    
    uploadZone?.addEventListener('dragleave', () => {
        uploadZone.classList.remove('border-blue-500', 'bg-blue-50');
    });
    
    uploadZone?.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('border-blue-500', 'bg-blue-50');
        handleFiles(e.dataTransfer.files);
    });
    
    // Handle files
    async function handleFiles(files) {
        for (const file of files) {
            if (file.type === 'application/pdf') {
                await uploadFile(file);
            } else {
                alert(`${file.name} n'est pas un fichier PDF`);
            }
        }
    }
    
    // Upload file
    async function uploadFile(file) {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('project_id', 'kahnawake'); // Default project
        
        // Show progress
        const progressDiv = document.createElement('div');
        progressDiv.className = 'p-4 bg-blue-50 border-l-4 border-blue-500 mb-4';
        progressDiv.innerHTML = `
            <div class="flex items-center">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-3"></div>
                <span>Upload de ${file.name}...</span>
            </div>
        `;
        document.getElementById('documentsList').prepend(progressDiv);
        
        try {
            const response = await fetch('http://localhost:5000/upload', {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                const result = await response.json();
                progressDiv.innerHTML = `
                    <div class="flex items-center text-green-600">
                        <i data-lucide="check-circle" class="w-6 h-6 mr-3"></i>
                        <span>${file.name} uploadé avec succès!</span>
                    </div>
                `;
                
                // Refresh documents list
                setTimeout(() => {
                    loadDocuments();
                }, 2000);
            } else {
                throw new Error('Upload failed');
            }
        } catch (error) {
            progressDiv.innerHTML = `
                <div class="flex items-center text-red-600">
                    <i data-lucide="x-circle" class="w-6 h-6 mr-3"></i>
                    <span>Erreur lors de l'upload de ${file.name}</span>
                </div>
            `;
        }
        
        // Re-initialize lucide icons
        lucide.createIcons();
    }
    
    // Load documents list
    
        } catch (error) {
            console.error('Error loading documents:', error);
        }
    }
</script>

    <!-- Plan Viewer Integration -->
    <script src="assets/js/plan-viewer.js">
    
    // Upload PDF functionality
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const selectFilesBtn = document.getElementById('selectFiles');
    const uploadBtn = document.getElementById('uploadBtn');
    
    // Click to select files
    selectFilesBtn?.addEventListener('click', () => fileInput.click());
    uploadBtn?.addEventListener('click', () => fileInput.click());
    
    // File input change
    fileInput?.addEventListener('change', (e) => {
        handleFiles(e.target.files);
    });
    
    // Drag and drop
    uploadZone?.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('border-blue-500', 'bg-blue-50');
    });
    
    uploadZone?.addEventListener('dragleave', () => {
        uploadZone.classList.remove('border-blue-500', 'bg-blue-50');
    });
    
    uploadZone?.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('border-blue-500', 'bg-blue-50');
        handleFiles(e.dataTransfer.files);
    });
    
    // Handle files
    async function handleFiles(files) {
        for (const file of files) {
            if (file.type === 'application/pdf') {
                await uploadFile(file);
            } else {
                alert(`${file.name} n'est pas un fichier PDF`);
            }
        }
    }
    
    // Upload file
    async function uploadFile(file) {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('project_id', 'kahnawake'); // Default project
        
        // Show progress
        const progressDiv = document.createElement('div');
        progressDiv.className = 'p-4 bg-blue-50 border-l-4 border-blue-500 mb-4';
        progressDiv.innerHTML = `
            <div class="flex items-center">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-3"></div>
                <span>Upload de ${file.name}...</span>
            </div>
        `;
        document.getElementById('documentsList').prepend(progressDiv);
        
        try {
            const response = await fetch('http://localhost:5000/upload', {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                const result = await response.json();
                progressDiv.innerHTML = `
                    <div class="flex items-center text-green-600">
                        <i data-lucide="check-circle" class="w-6 h-6 mr-3"></i>
                        <span>${file.name} uploadé avec succès!</span>
                    </div>
                `;
                
                // Refresh documents list
                setTimeout(() => {
                    loadDocuments();
                }, 2000);
            } else {
                throw new Error('Upload failed');
            }
        } catch (error) {
            progressDiv.innerHTML = `
                <div class="flex items-center text-red-600">
                    <i data-lucide="x-circle" class="w-6 h-6 mr-3"></i>
                    <span>Erreur lors de l'upload de ${file.name}</span>
                </div>
            `;
        }
        
        // Re-initialize lucide icons
        lucide.createIcons();
    }
    
    // Load documents list
    
        } catch (error) {
            console.error('Error loading documents:', error);
        }
    }
</script>
    <script>
        // Initialize plan viewer when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {

        // Navigation entre onglets
        document.querySelectorAll('.sidebar-item[data-tab]').forEach(button => {
            button.addEventListener('click', function() {
                const tabName = this.getAttribute('data-tab');
                switchTab(tabName);
            });
        });
        
        // Masquer tous les contenus sauf le dashboard au démarrage
        document.querySelectorAll('.tab-content').forEach(content => {
            content.style.display = 'none';
        });
        
        // Afficher le dashboard par défaut
        const dashboardContent = document.getElementById('dashboard');
        if (dashboardContent) {
            dashboardContent.style.display = 'block';
        }
        

            // Find the plan container
            const planContainer = document.querySelector('#plan .relative.bg-gray-900');
            if (planContainer && planContainer.id !== 'planViewerContainer') {
                planContainer.id = 'planViewerContainer';
                
                // Initialize the plan viewer
                const viewer = new PlanViewer('planViewerContainer');
                
                // Handle zoom buttons
                const zoomInBtn = document.querySelector('[data-lucide="zoom-in"]')?.closest('button');
                const zoomOutBtn = document.querySelector('[data-lucide="layers"]')?.closest('button');
                
                if (zoomInBtn) {
                    zoomInBtn.addEventListener('click', () => viewer.zoomIn());
                }
                
                if (zoomOutBtn) {
                    // Repurpose layers button as zoom out
                    zoomOutBtn.innerHTML = '<i data-lucide="zoom-out" class="w-4 h-4 inline mr-1"></i>Zoom -';
                    zoomOutBtn.addEventListener('click', () => viewer.zoomOut());
                }
                
                // Update zoom level display
                viewer.container.addEventListener('zoomchange', (e) => {
                    const zoomText = zoomInBtn?.parentElement?.querySelector('.text-sm');
                    if (zoomText) {
                        zoomText.textContent = `Zoom: ${e.detail.percentage}%`;
                    }
                });
                
                // Add reset view functionality
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'r' && e.ctrlKey) {
                        e.preventDefault();
                        viewer.resetView();
                    }
                });
                
                console.log('✅ Plan viewer initialized successfully');
            }
        });
    
    
    // Upload PDF functionality
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const selectFilesBtn = document.getElementById('selectFiles');
    const uploadBtn = document.getElementById('uploadBtn');
    
    // Click to select files
    selectFilesBtn?.addEventListener('click', () => fileInput.click());
    uploadBtn?.addEventListener('click', () => fileInput.click());
    
    // File input change
    fileInput?.addEventListener('change', (e) => {
        handleFiles(e.target.files);
    });
    
    // Drag and drop
    uploadZone?.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('border-blue-500', 'bg-blue-50');
    });
    
    uploadZone?.addEventListener('dragleave', () => {
        uploadZone.classList.remove('border-blue-500', 'bg-blue-50');
    });
    
    uploadZone?.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('border-blue-500', 'bg-blue-50');
        handleFiles(e.dataTransfer.files);
    });
    
    // Handle files
    async function handleFiles(files) {
        for (const file of files) {
            if (file.type === 'application/pdf') {
                await uploadFile(file);
            } else {
                alert(`${file.name} n'est pas un fichier PDF`);
            }
        }
    }
    
    // Upload file
    async function uploadFile(file) {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('project_id', 'kahnawake'); // Default project
        
        // Show progress
        const progressDiv = document.createElement('div');
        progressDiv.className = 'p-4 bg-blue-50 border-l-4 border-blue-500 mb-4';
        progressDiv.innerHTML = `
            <div class="flex items-center">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-3"></div>
                <span>Upload de ${file.name}...</span>
            </div>
        `;
        document.getElementById('documentsList').prepend(progressDiv);
        
        try {
            const response = await fetch('http://localhost:5000/upload', {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                const result = await response.json();
                progressDiv.innerHTML = `
                    <div class="flex items-center text-green-600">
                        <i data-lucide="check-circle" class="w-6 h-6 mr-3"></i>
                        <span>${file.name} uploadé avec succès!</span>
                    </div>
                `;
                
                // Refresh documents list
                setTimeout(() => {
                    loadDocuments();
                }, 2000);
            } else {
                throw new Error('Upload failed');
            }
        } catch (error) {
            progressDiv.innerHTML = `
                <div class="flex items-center text-red-600">
                    <i data-lucide="x-circle" class="w-6 h-6 mr-3"></i>
                    <span>Erreur lors de l'upload de ${file.name}</span>
                </div>
            `;
        }
        
        // Re-initialize lucide icons
        lucide.createIcons();
    }
    
    // Load documents list
    
        } catch (error) {
            console.error('Error loading documents:', error);
        }
    }

    // Fonction pour changer d'onglet
    function switchTab(tabName) {
        // Masquer tous les contenus d'onglet
        document.querySelectorAll('.tab-content').forEach(content => {
            content.style.display = 'none';
        });
        
        // Retirer la classe active de tous les boutons
        document.querySelectorAll('.sidebar-item').forEach(button => {
            button.classList.remove('active');
        });
        
        // Afficher le contenu de l'onglet sélectionné
        const selectedContent = document.getElementById(tabName);
        if (selectedContent) {
            selectedContent.style.display = 'block';
            
            // Si c'est l'onglet documents, charger la liste
            if (tabName === 'documents') {
                loadDocuments();
            }
        }
        
        // Ajouter la classe active au bouton sélectionné
        const selectedButton = document.querySelector(`[data-tab="${tabName}"]`);
        if (selectedButton) {
            selectedButton.classList.add('active');
        }
    }


    // Configuration de la navigation entre onglets
    document.addEventListener('DOMContentLoaded', function() {
        // Attacher les event listeners aux boutons de navigation
        document.querySelectorAll('.sidebar-item[data-tab]').forEach(button => {
            button.addEventListener('click', function() {
                const tabName = this.getAttribute('data-tab');
                switchTab(tabName);
            });
        });
        
        // Initialiser avec le dashboard par défaut
        switchTab('dashboard');
        
        // Charger les documents si on arrive directement sur cet onglet
        const urlParams = new URLSearchParams(window.location.search);
        const tab = urlParams.get('tab');
        if (tab) {
            switchTab(tab);
        }
    });
</script>

</body>
</html>